<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pembayaran - Gibran Store</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #121212; color: white; margin: 0; padding-bottom: 30px; }
        .header { background: #1f1f1f; padding: 20px; text-align: center; border-bottom: 2px solid #ff9800; }
        .container { padding: 20px; }
        .total-box { background: #1f1f1f; padding: 20px; border-radius: 15px; border: 1px dashed #ff9800; text-align: center; margin-bottom: 25px; }
        .total-amount { font-size: 28px; font-weight: bold; color: #ff9800; display: block; }
        .pay-method { background: #1f1f1f; border: 1px solid #333; border-radius: 12px; padding: 15px; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; }
        .pay-active { border: 1px solid #ff9800; }
        .pay-locked { opacity: 0.4; cursor: not-allowed; }
        .btn-bayar { background: #ff9800; color: black; border: none; width: 100%; padding: 18px; border-radius: 12px; font-weight: bold; font-size: 16px; margin-top: 20px; cursor: pointer; }
    </style>
</head>
<body>

    <div class="header">
        <h2 style="margin:0; color:#ff9800;">Pembayaran</h2>
    </div>

    <div class="container">
        <div class="total-box">
            <span style="color:#888; font-size:14px;">Total Tagihan</span>
            <span class="total-amount" id="tagihan">Rp0</span>
        </div>

        <p style="font-size: 12px; color: #888; margin-bottom: 10px;">PILIH METODE</p>

        <div class="pay-method pay-active">
            <div>
                <h4 style="margin:0;">Cash (Bayar di Tempat)</h4>
                <p style="margin:4px 0 0 0; font-size:12px; color:#777;">Bayar tunai saat barang sampai</p>
            </div>
            <span style="color:#ff9800;">âœ”</span>
        </div>

        <div class="pay-method pay-locked">
            <div><h4>QRIS / E-Wallet ðŸ”’</h4></div>
            <span>ðŸ”’</span>
        </div>

        <button class="btn-bayar" id="btnKonfirmasi" onclick="selesaikanOrder()">KONFIRMASI PEMBAYARAN</button>
    </div>

    <script>
        const keranjang = JSON.parse(localStorage.getItem('keranjang')) || [];
        const total = keranjang.reduce((a, b) => a + b.harga, 0);
        document.getElementById('tagihan').innerText = "Rp" + total.toLocaleString('id-ID');

        function selesaikanOrder() {
            if (keranjang.length === 0) {
                alert("Keranjang kosong!");
                return;
            }

            const btn = document.getElementById('btnKonfirmasi');
            btn.innerText = "Mengirim Pesanan...";
            btn.disabled = true;

            const listProduk = keranjang.map(item => item.produk).join(", ");

            const dataFinal = {
                tanggal: new Date().toLocaleString('id-ID'),
                nama: localStorage.getItem('userNama') || "Tanpa Nama",
                hp: localStorage.getItem('userHP') || "-",
                alamat: localStorage.getItem('userAlamat') || "Tanpa Alamat",
                pesanan: listProduk,
                total: total.toLocaleString('id-ID')
            };

            // SIMPAN KE RIWAYAT HP
            let riwayat = JSON.parse(localStorage.getItem('semuaPesanan')) || [];
            riwayat.push(dataFinal);
            localStorage.setItem('semuaPesanan', JSON.stringify(riwayat));

            // KIRIM KE GOOGLE SHEETS (LINK BARU KAMU)
            fetch("https://script.google.com/macros/s/AKfycbwLzlRQm0FOr8JCoD8Q4aylAgnVccH2OIv1Jefq9f49c3iqQBL7bVUe7FmFci4DDuTL8A/exec", {
                method: 'POST',
                mode: 'no-cors',
                body: JSON.stringify(dataFinal)
            }).then(() => {
                localStorage.removeItem('keranjang');
                alert("Pesanan Berhasil! Data sudah masuk ke admin.");
                window.location.href = "riwayat.html";
            }).catch((err) => {
                console.log("Error:", err);
                // Tetap pindah ke riwayat meski fetch no-cors
                localStorage.removeItem('keranjang');
                window.location.href = "riwayat.html";
            });
        }
    </script>
</body>
</html>
