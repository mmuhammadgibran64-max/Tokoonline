<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Konfirmasi Pembayaran</title>
    <style>
        body { font-family: sans-serif; background: #121212; color: white; padding: 20px; }
        .box { background: #1f1f1f; padding: 20px; border-radius: 15px; border: 1px solid #ff9800; max-width: 400px; margin: auto; }
        input, select, textarea { width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; border: none; background: #2c2c2c; color: white; box-sizing: border-box; }
        button { background: #28a745; color: white; width: 100%; padding: 15px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        button:disabled { background: #555; }
        .info { background: #2c2c2c; padding: 10px; border-radius: 8px; font-size: 14px; margin-bottom: 10px; }
    </style>
</head>
<body>
    <div class="box">
        <h3>Detail Pesanan</h3>
        <div class="info">
            <b>Pesanan:</b> <span id="ringkasan"></span><br>
            <b>Total:</b> <span id="total-harga"></span>
        </div>
        
        <label style="font-size:12px; color:orange;">Metode Pembayaran:</label>
        <select id="metode" onchange="cekMetode()">
            <option value="Cash">Cash (Bayar di Tempat)</option>
            <option value="QRIS">QRIS (Maintenance)</option>
        </select>
        <p id="err" style="color:red; font-size:11px; display:none;">Metode sedang perbaikan, pilih Cash!</p>

        <input type="text" id="nama" readonly>
        <textarea id="alamat" readonly></textarea>
        
        <button id="btnKirim" onclick="kirim()">KONFIRMASI & KIRIM</button>
    </div>

    <script>
        const namaUser = localStorage.getItem('userNama');
        const alamatUser = localStorage.getItem('userAlamat');
        const pesananUser = localStorage.getItem('tempOrder');
        const totalUser = localStorage.getItem('tempTotal');

        document.getElementById('nama').value = namaUser;
        document.getElementById('alamat').value = alamatUser;
        document.getElementById('ringkasan').innerText = pesananUser;
        document.getElementById('total-harga').innerText = "Rp " + parseInt(totalUser).toLocaleString('id-ID');

        function cekMetode() {
            const m = document.getElementById('metode').value;
            document.getElementById('btnKirim').disabled = (m !== "Cash");
            document.getElementById('err').style.display = (m !== "Cash" ? "block" : "none");
        }

        function kirim() {
            const btn = document.getElementById('btnKirim');
            btn.innerText = "Mengirim...";
            btn.disabled = true;

            const data = {
                tanggal: new Date().toLocaleString('id-ID'),
                nama: namaUser,
                hp: localStorage.getItem('userHP'),
                alamat: alamatUser,
                pesanan: pesananUser + " (Metode: " + document.getElementById('metode').value + ")",
                total: "Rp " + parseInt(totalUser).toLocaleString('id-ID')
            };

            // Simpan ke Riwayat HP
            let riwayat = JSON.parse(localStorage.getItem('riwayatPesanan')) || [];
            riwayat.push(data);
            localStorage.setItem('riwayatPesanan', JSON.stringify(riwayat));

            // Kirim ke Google Sheets (Link Baru)
            fetch("https://script.google.com/macros/s/AKfycbzkcUtd6vLZg5_5N6MMGn2P8vtX1w7ikjtEsfN3x_mWhukHduvlm1nottrihyZWzZ7c8w/exec", {
                method: 'POST',
                mode: 'no-cors',
                body: JSON.stringify(data)
            }).then(() => {
                window.location.href = "selesai.html";
            }).catch(() => {
                alert("Berhasil terkirim!");
                window.location.href = "selesai.html";
            });
        }
    </script>
</body>
</html>
