<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metode Pembayaran</title>
    <style>
        body { font-family: sans-serif; background: #121212; color: white; padding: 20px; }
        .box { background: #1f1f1f; padding: 20px; border-radius: 15px; border: 1px solid #ff9800; max-width: 400px; margin: auto; }
        .item-info { background: #2c2c2c; padding: 10px; border-radius: 8px; margin-bottom: 15px; font-size: 14px; }
        label { font-size: 12px; color: #ff9800; display: block; margin-top: 10px; }
        input, select { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: none; background: #2c2c2c; color: white; box-sizing: border-box; }
        .warning { color: #ff4444; font-size: 11px; margin-top: -5px; display: none; }
        button { background: #28a745; color: white; width: 100%; padding: 15px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 20px; font-size: 16px; }
        button:disabled { background: #555; cursor: not-allowed; }
    </style>
</head>
<body>

<div class="box">
    <h3 style="text-align:center; color:#ff9800;">Konfirmasi Pembayaran</h3>
    
    <div class="item-info">
        <b>Ringkasan Pesanan:</b><br>
        <span id="list-pesanan"></span><br>
        <b style="color:#ff9800;">Total: <span id="total-harga"></span></b>
    </div>

    <form id="payForm">
        <label>Metode Pembayaran:</label>
        <select id="metode" onchange="cekMetode()" required>
            <option value="Cash">Cash (Bayar di Tempat)</option>
            <option value="QRIS">QRIS (Maintenance)</option>
            <option value="Transfer">Transfer Bank (Maintenance)</option>
        </select>
        <p id="pesan-error" class="warning">Maaf, metode ini sedang dalam perbaikan. Pilih Cash dulu ya!</p>

        <label>Nama Penerima:</label>
        <input type="text" id="nama" readonly>

        <label>Alamat Pengiriman:</label>
        <input type="text" id="alamat" readonly>

        <button type="submit" id="btnKirim">KONFIRMASI & KIRIM</button>
    </form>
</div>

<script>
    // Ambil data dari dashboard & login
    const pesanan = localStorage.getItem('tempOrder') || "-";
    const total = localStorage.getItem('tempTotal') || "0";
    const namaUser = localStorage.getItem('userNama') || "-";
    const alamatUser = localStorage.getItem('userAlamat') || "-";

    document.getElementById('list-pesanan').innerText = pesanan;
    document.getElementById('total-harga').innerText = "Rp " + parseInt(total).toLocaleString();
    document.getElementById('nama').value = namaUser;
    document.getElementById('alamat').value = alamatUser;

    function cekMetode() {
        const metode = document.getElementById('metode').value;
        const btn = document.getElementById('btnKirim');
        const warning = document.getElementById('pesan-error');

        if (metode !== "Cash") {
            warning.style.display = "block";
            btn.disabled = true;
        } else {
            warning.style.display = "none";
            btn.disabled = false;
        }
    }

    document.getElementById('payForm').onsubmit = function(e) {
        e.preventDefault();
        const btn = document.getElementById('btnKirim');
        btn.innerText = "Mengirim ke Sheet...";
        btn.disabled = true;

        const data = {
            tanggal: new Date().toLocaleString('id-ID'),
            nama: namaUser,
            hp: localStorage.getItem('userHP'),
            alamat: alamatUser,
            pesanan: pesanan + " (Metode: " + document.getElementById('metode').value + ")",
            total: "Rp " + parseInt(total).toLocaleString()
        };

        const urlScript = "https://script.google.com/macros/s/AKfycbzRuPeyVzZDblhXsb1dZvQFZBkn32SElJcLiuawpB0Gz2xVQlWkgLlcToMOAVediNcQ8Q/exec";

        fetch(urlScript, {
            method: 'POST',
            mode: 'no-cors',
            body: JSON.stringify(data)
        }).then(() => {
            window.location.href = "selesai.html";
        }).catch(err => {
            alert("Gagal mengirim: " + err);
            btn.innerText = "KIRIM ULANG";
            btn.disabled = false;
        });
    };
</script>

</body>
</html>
