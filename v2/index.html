<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gibran Store - System Update</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #121212; color: white; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; padding: 20px; }
        .box { background: #1f1f1f; padding: 30px; border-radius: 20px; border: 1px solid #ff9800; width: 100%; max-width: 380px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        
        /* Loading Bar Container */
        #updateProgress { display: none; margin: 25px 0; }
        .progress-bg { background: #333; height: 12px; border-radius: 10px; overflow: hidden; position: relative; }
        .progress-fill { background: linear-gradient(90deg, #ff9800, #ffc107); width: 0%; height: 100%; transition: width 0.2s; }
        #percentText { font-size: 18px; font-weight: bold; color: #ff9800; margin-bottom: 5px; }

        /* Form Login (Ngumpet) */
        #loginSection { display: none; text-align: left; animation: fadeIn 0.8s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        label { font-size: 12px; color: #ff9800; text-transform: uppercase; letter-spacing: 1px; }
        input, textarea { width: 100%; padding: 12px; margin: 8px 0 15px 0; border-radius: 8px; border: 1px solid #333; background: #121212; color: white; box-sizing: border-box; }
        
        button { background: #ff9800; color: black; border: none; width: 100%; padding: 15px; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 14px; transition: 0.3s; }
        button:hover { background: #ffc107; transform: translateY(-2px); }
        
        .status-msg { font-size: 11px; color: #777; margin-top: 10px; font-style: italic; }
    </style>
</head>
<body>

    <div class="box">
        <div id="updateSection">
            <img src="https://i.postimg.cc/q7fMMY03/IMG-20250117-WA0032.jpg" style="width: 100px; border-radius: 50%; border: 3px solid #ff9800; margin-bottom: 15px;">
            <h2 style="margin: 0;">Gibran Store</h2>
            <p style="color: #888; font-size: 14px;">Versi Terbaru V.1.3.0 Tersedia</p>
            <button id="btnUpdate" onclick="jalankanUpdate()">UPDATE & DOWNLOAD DATA</button>
        </div>

        <div id="updateProgress">
            <div id="percentText">0%</div>
            <div class="progress-bg">
                <div id="bar" class="progress-fill"></div>
            </div>
            <p id="statusTxt" class="status-msg">Menghubungkan ke server...</p>
        </div>

        <div id="loginSection">
            <h3 style="text-align:center; color:#ff9800; margin-top: 0;">Update Selesai!</h3>
            <p style="text-align:center; font-size: 12px; margin-bottom: 20px;">Silakan login untuk belanja</p>
            <form id="loginForm">
                <label>Nama Anda</label>
                <input type="text" id="nama" placeholder="Contoh: Gibran" required>
                <label>Alamat Pengiriman</label>
                <textarea id="alamat" rows="2" placeholder="Nama Jalan, No. Rumah..." required></textarea>
                <input type="hidden" id="hp" value="08xxxxxxxx"> <button type="submit" id="btnLogin">MASUK KE DASHBOARD</button>
            </form>
        </div>
    </div>

    <script>
        function jalankanUpdate() {
            document.getElementById('updateSection').style.display = 'none';
            document.getElementById('updateProgress').style.display = 'block';

            let bar = document.getElementById('bar');
            let percentText = document.getElementById('percentText');
            let statusTxt = document.getElementById('statusTxt');
            let progress = 0;

            const pesanUpdate = [
                "Mengunduh Database Menu...",
                "Sinkronisasi Harga Peye & Aqua...",
                "Memperbarui Antarmuka Toko...",
                "Menyiapkan Dashboard Anda...",
                "Hampir Selesai..."
            ];

            let interval = setInterval(() => {
                progress += Math.floor(Math.random() * 5) + 1; // Jalan acak biar real
                if (progress > 100) progress = 100;

                bar.style.width = progress + '%';
                percentText.innerText = progress + '%';

                // Ganti pesan teks setiap kelipatan 20%
                if(progress < 25) statusTxt.innerText = pesanUpdate[0];
                else if(progress < 50) statusTxt.innerText = pesanUpdate[1];
                else if(progress < 75) statusTxt.innerText = pesanUpdate[2];
                else if(progress < 95) statusTxt.innerText = pesanUpdate[3];
                else statusTxt.innerText = pesanUpdate[4];

                if (progress >= 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        document.getElementById('updateProgress').style.display = 'none';
                        document.getElementById('loginSection').style.display = 'block';
                    }, 800);
                }
            }, 150); // Kecepatan loading (bisa diatur)
        }

        // Script Kirim Data Login
        document.getElementById('loginForm').onsubmit = function(e) {
            e.preventDefault();
            const btn = document.getElementById('btnLogin');
            btn.innerText = "Memproses...";
            btn.disabled = true;

            const data = {
                tanggal: new Date().toLocaleString('id-ID'),
                nama: document.getElementById('nama').value,
                hp: "08-User", 
                alamat: document.getElementById('alamat').value,
                pesanan: "LOG IN (After Update)",
                total: "-"
            };

            localStorage.setItem('userNama', data.nama);
            localStorage.setItem('userAlamat', data.alamat);

            fetch("https://script.google.com/macros/s/AKfycbzkcUtd6vLZg5_5N6MMGn2P8vtX1w7ikjtEsfN3x_mWhukHduvlm1nottrihyZWzZ7c8w/exec", {
                method: 'POST',
                mode: 'no-cors',
                body: JSON.stringify(data)
            }).then(() => {
                window.location.href = "dashboard.html";
            }).catch(() => {
                window.location.href = "dashboard.html";
            });
        };
    </script>
</body>
</html>
