<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Bayar - GIBRAN STORE</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light d-flex align-items-center justify-content-center" style="height:100vh">
    <div class="card p-4 text-center shadow-sm" style="width:350px; border-radius:20px;">
        <p class="text-muted small mb-1">Total Tagihan</p>
        <h2 class="fw-bold text-success" id="tot">Rp 0</h2>
        <hr>
        <button class="btn btn-warning w-100 fw-bold py-3" id="btn" onclick="bayar()">KONFIRMASI PESANAN</button>
    </div>

    <script>
        const scriptURL = 'https://script.google.com/macros/s/AKfycbzG9zsxwzIfPkpACliJcs5GW_xn0ayyQxwSg9fGj4zX1Is9I8yGiCI91_qG2oDNmJ0j3w/exec';
        document.getElementById('tot').innerText = 'Rp ' + parseInt(localStorage.getItem('totalTerakhir')).toLocaleString();

        function bayar() {
            const btn = document.getElementById('btn');
            btn.innerText = "Memproses...";
            btn.disabled = true;

            const data = {
                sheet: "Pesanan",
                tanggal: new Date().toLocaleString('id-ID'),
                nama: localStorage.getItem('namaUser'),
                pesanan: localStorage.getItem('detailPesanan'),
                total: localStorage.getItem('totalTerakhir')
            };

            fetch(scriptURL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(data) })
            .then(() => {
                // Simpan ke riwayat lokal HP
                let r = JSON.parse(localStorage.getItem('riwayatPesanan')) || [];
                r.push(data);
                localStorage.setItem('riwayatPesanan', JSON.stringify(r));
                
                window.location.href = 'selesai-pembayaran.html';
            }).catch(() => { alert("Gagal kirim pesanan."); btn.disabled = false; });
        }
    </script>
</body>
</html>
