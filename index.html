<script>
    // --- PENTING: Ganti versi ini kalau lo mau ada update lagi besok-besok ---
    const VERSI_SEKARANG = "1.2.9"; 

    window.onload = function() {
        // Cek apakah user sudah pernah download versi ini sebelumnya
        const sudahUpdate = localStorage.getItem("statusUpdate");

        if (sudahUpdate === VERSI_SEKARANG) {
            // Kalau sudah pernah download versi yang sama, langsung pindah ke v2
            window.location.href = "v2/index.html";
        }
    };

    function startSync() {
        document.getElementById('btnDownload').style.display = "none";
        document.getElementById('downloadSection').style.display = "block";
        
        const bar = document.getElementById('bar');
        const status = document.getElementById('statusUpdate');
        const percent = document.getElementById('percent');
        
        const steps = [
            { p: 20, t: "Sinkronisasi Akun...", s: 800 },
            { p: 50, t: "Memasang Fitur v." + VERSI_SEKARANG + "...", s: 1200 },
            { p: 80, t: "Menyimpan Data ke Sistem...", s: 1000 },
            { p: 100, t: "Update Berhasil!", s: 500 }
        ];

        let i = 0;
        function runStep() {
            if (i < steps.length) {
                bar.style.width = steps[i].p + "%";
                percent.innerHTML = steps[i].p + "%";
                status.innerHTML = steps[i].t;
                setTimeout(() => { i++; runStep(); }, steps[i-1] ? steps[i].s : 500);
            } else {
                // SIMPAN MEMORI: Tandai kalau versi ini sudah di-download
                localStorage.setItem("statusUpdate", VERSI_SEKARANG);
                
                document.getElementById('btnMasuk').style.display = "block";
                status.style.color = "#25d366";
            }
        }
        runStep();
    }
</script>
